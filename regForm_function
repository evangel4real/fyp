<?php
include("connect_to_mysql.php");
//Error Reporting
error_reporting(E_ALL);
ini_set('display_errors','1');

$link = connection();

//this will parse the form data and add member to the system.
  
  function InsertUser (){
	  global $link;
	  
	  //this will parse the form data and add member to the system.
	   
	 if (isset($_POST["submit"])) {
		 
		$fullName = mysqli_real_escape_string($link, $_POST["fName"]);
		$email = mysqli_real_escape_string($link, $_POST["email"]);
		$phone = mysqli_real_escape_string($link, $_POST["phone"]);
		$date = mysqli_real_escape_string($link, $_POST["dob"]);
		$address = mysqli_real_escape_string($link, $_POST["address"]);
		$country = mysqli_real_escape_string($link, $_POST["country"]);
		$state = mysqli_real_escape_string($link, $_POST["state"]);
		$city = mysqli_real_escape_string($link, $_POST["city"]);
		$username = mysqli_real_escape_string($link, $_POST["username"]);
		$password =md5($_POST["password"]);
		$c_password = md5($_POST["c_password"]);
	   
	   	//this will check to see if there is an identical match to another email in the database
		$get_email = "SELECT * FROM register WHERE email='$email' LIMIT 1 ";
		$run_email = mysqli_query($link, $get_email);
		$check_email = mysqli_num_rows($run_email);
		
		$get_user = "SELECT * FROM register WHERE username='$username' LIMIT 1 ";
		$run_user = mysqli_query($link, $get_user);
		$check_user = mysqli_num_rows($run_user);

		//$check_user = mysqli_num_rows($run_email);
				 if($check_email > 0){
					echo "<script>alert('This Email is already registered')</script>";
					exit();
				}
				else if($check_user > 0){
					echo "<script>alert('This username is already registered')</script>";
					exit();
				}
				else if(strlen($password) < 6){
					echo "<script>alert('Password must not be less than 6 characters')</script>";
					exit();
				}
				else if($c_password != $password){
					echo "<script>alert('Passwords do not match')</script>";;
					exit();
				}
				/*else if(empty($_SESSION['6_letters_code'] ) ||
				  strcasecmp($_SESSION['6_letters_code'], $_POST['6_letters_code']) != 0)
				{
				//Note: the captcha code is compared case insensitively.
					echo "<script>alert (The captcha code does not match!)";
				}*/
			
	 	else{
				 $insert = "insert into register(fName, email, phone, dob, address, country, state, city, username, password, c_password, usertype, date_added)
				 values('$fullName', '$email', '$phone', '$date', '$address', '$country', '$state', '$city', '$username', '$password', '$c_password','user', now())";
				 
				 $run_insert = mysqli_query($link, $insert);
				 if($run_insert){
					echo "<script>alert('Thank you for registering with us.')</script>";	
					echo "<script>window.open('login.php', '_self')</script>";			           
				 }	
		}
	} 
		
  
 }
 ?>
